"use strict";

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

const fs = require('fs');

const path = require('path');

const juice = require('juice');

const debug = require('debug')('email-templates');

const htmlToText = require('html-to-text');

const I18N = require('@ladjs/i18n');

const autoBind = require('auto-bind');

const nodemailer = require('nodemailer');

const consolidate = require('consolidate');

const previewEmail = require('preview-email');

const _ = require('lodash');

const _Promise = require('bluebird');

const s = require('underscore.string');

const getPaths = require('get-paths'); // promise version of `juice.juiceResources`


const juiceResources = (html, options) => {
  return new _Promise((resolve, reject) => {
    juice.juiceResources(html, options, (err, html) => {
      if (err) return reject(err);
      resolve(html);
    });
  });
};

const env = (process.env.NODE_ENV || 'development').toLowerCase();

const stat = _Promise.promisify(fs.stat);

const readFile = _Promise.promisify(fs.readFile);

class Email {
  constructor(config = {}) {
    debug('config passed %O', config); // 2.x backwards compatible support

    if (config.juiceOptions) {
      config.juiceResources = config.juiceOptions;
      delete config.juiceOptions;
    }

    if (config.disableJuice) {
      config.juice = false;
      delete config.disableJuice;
    }

    if (config.render) {
      config.customRender = true;
    }

    this.config = _.merge({
      views: {
        // directory where email templates reside
        root: path.resolve('emails'),
        options: {
          // default file extension for template
          extension: 'pug',
          map: {
            hbs: 'handlebars',
            njk: 'nunjucks'
          },
          engineSource: consolidate
        },
        // locals to pass to templates for rendering
        locals: {
          // pretty is automatically set to `false` for subject/text
          pretty: true
        }
      },
      // <https://nodemailer.com/message/>
      message: {},
      send: !['development', 'test'].includes(env),
      preview: env === 'development',
      // <https://github.com/ladjs/i18n>
      // set to an object to configure and enable it
      i18n: false,
      // pass a custom render function if necessary
      render: this.render.bind(this),
      customRender: false,
      // force text-only rendering of template (disregards template folder)
      textOnly: false,
      // <https://github.com/werk85/node-html-to-text>
      htmlToText: {
        ignoreImage: true
      },
      subjectPrefix: false,
      // <https://github.com/Automattic/juice>
      juice: true,
      juiceResources: {
        preserveImportant: true,
        webResources: {
          relativeTo: path.resolve('build'),
          images: false
        }
      },
      // pass a transport configuration object or a transport instance
      // (e.g. an instance is created via `nodemailer.createTransport`)
      // <https://nodemailer.com/transports/>
      transport: {}
    }, config); // override existing method

    this.render = this.config.render;
    if (!_.isFunction(this.config.transport.sendMail)) this.config.transport = nodemailer.createTransport(this.config.transport);
    debug('transformed config %O', this.config);
    autoBind(this);
  } // shorthand use of `juiceResources` with the config
  // (mainly for custom renders like from a database)


  juiceResources(html) {
    return juiceResources(html, this.config.juiceResources);
  } // a simple helper function that gets the actual file path for the template


  getTemplatePath(template) {
    var _this = this;

    return _asyncToGenerator(function* () {
      const _ref = path.isAbsolute(template) ? [path.dirname(template), path.basename(template)] : [_this.config.views.root, template],
            _ref2 = _slicedToArray(_ref, 2),
            root = _ref2[0],
            view = _ref2[1];

      const paths = yield getPaths(root, view, _this.config.views.options.extension);
      const filePath = path.resolve(root, paths.rel);
      return {
        filePath,
        paths
      };
    })();
  } // returns true or false if a template exists
  // (uses same look-up approach as `render` function)


  templateExists(view) {
    var _this2 = this;

    return _asyncToGenerator(function* () {
      try {
        const _ref3 = yield _this2.getTemplatePath(view),
              filePath = _ref3.filePath;

        const stats = yield stat(filePath);
        if (!stats.isFile()) throw new Error(`${filePath} was not a file`);
        return true;
      } catch (err) {
        debug('templateExists', err);
        return false;
      }
    })();
  } // promise version of consolidate's render
  // inspired by koa-views and re-uses the same config
  // <https://github.com/queckezz/koa-views>


  render(view, locals = {}) {
    var _this3 = this;

    return _asyncToGenerator(function* () {
      const _this3$config$views$o = _this3.config.views.options,
            map = _this3$config$views$o.map,
            engineSource = _this3$config$views$o.engineSource;

      const _ref4 = yield _this3.getTemplatePath(view),
            filePath = _ref4.filePath,
            paths = _ref4.paths;

      if (paths.ext === 'html' && !map) {
        const res = yield readFile(filePath, 'utf8');
        return res;
      }

      const engineName = map && map[paths.ext] ? map[paths.ext] : paths.ext;
      const renderFn = engineSource[engineName];
      if (!engineName || !renderFn) throw new Error(`Engine not found for the ".${paths.ext}" file extension`);

      if (_.isObject(_this3.config.i18n)) {
        const i18n = new I18N(Object.assign({}, _this3.config.i18n, {
          register: locals
        })); // support `locals.user.last_locale`
        // (e.g. for <https://lad.js.org>)

        if (_.isObject(locals.user) && _.isString(locals.user.last_locale)) locals.locale = locals.user.last_locale;
        if (_.isString(locals.locale)) i18n.setLocale(locals.locale);
      }

      const res = yield _Promise.promisify(renderFn)(filePath, locals); // transform the html with juice using remote paths
      // google now supports media queries
      // https://developers.google.com/gmail/design/reference/supported_css

      if (!_this3.config.juice) return res;
      const html = yield _this3.juiceResources(res);
      return html;
    })();
  } // TODO: this needs refactored
  // so that we render templates asynchronously


  renderAll(template, locals = {}, message = {}) {
    var _this4 = this;

    return _asyncToGenerator(function* () {
      let subjectTemplateExists = _this4.config.customRender;
      let htmlTemplateExists = _this4.config.customRender;
      let textTemplateExists = _this4.config.customRender;

      if (template && !_this4.config.customRender) {
        var _ref5 = yield _Promise.all([_this4.templateExists(`${template}/subject`), _this4.templateExists(`${template}/html`), _this4.templateExists(`${template}/text`)]);

        var _ref6 = _slicedToArray(_ref5, 3);

        subjectTemplateExists = _ref6[0];
        htmlTemplateExists = _ref6[1];
        textTemplateExists = _ref6[2];
      }

      if (!message.subject && subjectTemplateExists) {
        message.subject = yield _this4.render(`${template}/subject`, Object.assign({}, locals, {
          pretty: false
        }));
        message.subject = message.subject.trim();
      }

      if (message.subject && _this4.config.subjectPrefix) message.subject = _this4.config.subjectPrefix + message.subject;
      if (!message.html && htmlTemplateExists) message.html = yield _this4.render(`${template}/html`, locals);
      if (!message.text && textTemplateExists) message.text = yield _this4.render(`${template}/text`, Object.assign({}, locals, {
        pretty: false
      }));
      if (_this4.config.htmlToText && message.html && !message.text) // we'd use nodemailer-html-to-text plugin
        // but we really don't need to support cid
        // <https://github.com/andris9/nodemailer-html-to-text>
        message.text = htmlToText.fromString(message.html, _this4.config.htmlToText); // if we only want a text-based version of the email

      if (_this4.config.textOnly) delete message.html; // if no subject, html, or text content exists then we should
      // throw an error that says at least one must be found
      // otherwise the email would be blank (defeats purpose of email-templates)

      if (s.isBlank(message.subject) && s.isBlank(message.text) && s.isBlank(message.html) && _.isArray(message.attachments) && _.isEmpty(message.attachments)) throw new Error(`No content was passed for subject, html, text, nor attachments message props. Check that the files for the template "${template}" exist.`);
      return message;
    })();
  }

  send(options = {}) {
    var _this5 = this;

    return _asyncToGenerator(function* () {
      options = Object.assign({
        template: '',
        message: {},
        locals: {}
      }, options);
      let _options = options,
          template = _options.template,
          message = _options.message,
          locals = _options.locals;
      const attachments = message.attachments || _this5.config.message.attachments || [];
      message = _.defaultsDeep({}, _.omit(message, 'attachments'), _.omit(_this5.config.message, 'attachments'));
      locals = _.defaultsDeep({}, _this5.config.views.locals, locals);
      if (attachments) message.attachments = attachments;
      debug('template %s', template);
      debug('message %O', message);
      debug('locals (keys only): %O', Object.keys(locals)); // get all available templates

      const obj = yield _this5.renderAll(template, locals, message); // assign the object variables over to the message

      Object.assign(message, obj);

      if (_this5.config.preview) {
        debug('using `preview-email` to preview email');
        yield previewEmail(message);
      }

      if (!_this5.config.send) {
        debug('send disabled so we are ensuring JSONTransport'); // <https://github.com/nodemailer/nodemailer/issues/798>
        // if (this.config.transport.name !== 'JSONTransport')

        _this5.config.transport = nodemailer.createTransport({
          jsonTransport: true
        });
      }

      const res = yield _this5.config.transport.sendMail(message);
      debug('message sent');
      res.originalMessage = message;
      return res;
    })();
  }

}

module.exports = Email;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwYXRoIiwianVpY2UiLCJkZWJ1ZyIsImh0bWxUb1RleHQiLCJJMThOIiwiYXV0b0JpbmQiLCJub2RlbWFpbGVyIiwiY29uc29saWRhdGUiLCJwcmV2aWV3RW1haWwiLCJfIiwiUHJvbWlzZSIsInMiLCJnZXRQYXRocyIsImp1aWNlUmVzb3VyY2VzIiwiaHRtbCIsIm9wdGlvbnMiLCJyZXNvbHZlIiwicmVqZWN0IiwiZXJyIiwiZW52IiwicHJvY2VzcyIsIk5PREVfRU5WIiwidG9Mb3dlckNhc2UiLCJzdGF0IiwicHJvbWlzaWZ5IiwicmVhZEZpbGUiLCJFbWFpbCIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwianVpY2VPcHRpb25zIiwiZGlzYWJsZUp1aWNlIiwicmVuZGVyIiwiY3VzdG9tUmVuZGVyIiwibWVyZ2UiLCJ2aWV3cyIsInJvb3QiLCJleHRlbnNpb24iLCJtYXAiLCJoYnMiLCJuamsiLCJlbmdpbmVTb3VyY2UiLCJsb2NhbHMiLCJwcmV0dHkiLCJtZXNzYWdlIiwic2VuZCIsImluY2x1ZGVzIiwicHJldmlldyIsImkxOG4iLCJiaW5kIiwidGV4dE9ubHkiLCJpZ25vcmVJbWFnZSIsInN1YmplY3RQcmVmaXgiLCJwcmVzZXJ2ZUltcG9ydGFudCIsIndlYlJlc291cmNlcyIsInJlbGF0aXZlVG8iLCJpbWFnZXMiLCJ0cmFuc3BvcnQiLCJpc0Z1bmN0aW9uIiwic2VuZE1haWwiLCJjcmVhdGVUcmFuc3BvcnQiLCJnZXRUZW1wbGF0ZVBhdGgiLCJ0ZW1wbGF0ZSIsImlzQWJzb2x1dGUiLCJkaXJuYW1lIiwiYmFzZW5hbWUiLCJ2aWV3IiwicGF0aHMiLCJmaWxlUGF0aCIsInJlbCIsInRlbXBsYXRlRXhpc3RzIiwic3RhdHMiLCJpc0ZpbGUiLCJFcnJvciIsImV4dCIsInJlcyIsImVuZ2luZU5hbWUiLCJyZW5kZXJGbiIsImlzT2JqZWN0IiwiT2JqZWN0IiwiYXNzaWduIiwicmVnaXN0ZXIiLCJ1c2VyIiwiaXNTdHJpbmciLCJsYXN0X2xvY2FsZSIsImxvY2FsZSIsInNldExvY2FsZSIsInJlbmRlckFsbCIsInN1YmplY3RUZW1wbGF0ZUV4aXN0cyIsImh0bWxUZW1wbGF0ZUV4aXN0cyIsInRleHRUZW1wbGF0ZUV4aXN0cyIsImFsbCIsInN1YmplY3QiLCJ0cmltIiwidGV4dCIsImZyb21TdHJpbmciLCJpc0JsYW5rIiwiaXNBcnJheSIsImF0dGFjaG1lbnRzIiwiaXNFbXB0eSIsImRlZmF1bHRzRGVlcCIsIm9taXQiLCJrZXlzIiwib2JqIiwianNvblRyYW5zcG9ydCIsIm9yaWdpbmFsTWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsTUFBTUEsRUFBRSxHQUFHQyxPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsTUFBTUcsS0FBSyxHQUFHSCxPQUFPLENBQUMsT0FBRCxDQUFQLENBQWlCLGlCQUFqQixDQUFkOztBQUNBLE1BQU1JLFVBQVUsR0FBR0osT0FBTyxDQUFDLGNBQUQsQ0FBMUI7O0FBQ0EsTUFBTUssSUFBSSxHQUFHTCxPQUFPLENBQUMsYUFBRCxDQUFwQjs7QUFDQSxNQUFNTSxRQUFRLEdBQUdOLE9BQU8sQ0FBQyxXQUFELENBQXhCOztBQUNBLE1BQU1PLFVBQVUsR0FBR1AsT0FBTyxDQUFDLFlBQUQsQ0FBMUI7O0FBQ0EsTUFBTVEsV0FBVyxHQUFHUixPQUFPLENBQUMsYUFBRCxDQUEzQjs7QUFDQSxNQUFNUyxZQUFZLEdBQUdULE9BQU8sQ0FBQyxlQUFELENBQTVCOztBQUNBLE1BQU1VLENBQUMsR0FBR1YsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBQ0EsTUFBTVcsUUFBTyxHQUFHWCxPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQSxNQUFNWSxDQUFDLEdBQUdaLE9BQU8sQ0FBQyxtQkFBRCxDQUFqQjs7QUFFQSxNQUFNYSxRQUFRLEdBQUdiLE9BQU8sQ0FBQyxXQUFELENBQXhCLEMsQ0FFQTs7O0FBQ0EsTUFBTWMsY0FBYyxHQUFHLENBQUNDLElBQUQsRUFBT0MsT0FBUCxLQUFtQjtBQUN4QyxTQUFPLElBQUlMLFFBQUosQ0FBWSxDQUFDTSxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDdENoQixJQUFBQSxLQUFLLENBQUNZLGNBQU4sQ0FBcUJDLElBQXJCLEVBQTJCQyxPQUEzQixFQUFvQyxDQUFDRyxHQUFELEVBQU1KLElBQU4sS0FBZTtBQUNqRCxVQUFJSSxHQUFKLEVBQVMsT0FBT0QsTUFBTSxDQUFDQyxHQUFELENBQWI7QUFDVEYsTUFBQUEsT0FBTyxDQUFDRixJQUFELENBQVA7QUFDRCxLQUhEO0FBSUQsR0FMTSxDQUFQO0FBTUQsQ0FQRDs7QUFTQSxNQUFNSyxHQUFHLEdBQUcsQ0FBQ0MsT0FBTyxDQUFDRCxHQUFSLENBQVlFLFFBQVosSUFBd0IsYUFBekIsRUFBd0NDLFdBQXhDLEVBQVo7O0FBQ0EsTUFBTUMsSUFBSSxHQUFHYixRQUFPLENBQUNjLFNBQVIsQ0FBa0IxQixFQUFFLENBQUN5QixJQUFyQixDQUFiOztBQUNBLE1BQU1FLFFBQVEsR0FBR2YsUUFBTyxDQUFDYyxTQUFSLENBQWtCMUIsRUFBRSxDQUFDMkIsUUFBckIsQ0FBakI7O0FBRUEsTUFBTUMsS0FBTixDQUFZO0FBQ1ZDLEVBQUFBLFdBQVcsQ0FBQ0MsTUFBTSxHQUFHLEVBQVYsRUFBYztBQUN2QjFCLElBQUFBLEtBQUssQ0FBQyxrQkFBRCxFQUFxQjBCLE1BQXJCLENBQUwsQ0FEdUIsQ0FHdkI7O0FBQ0EsUUFBSUEsTUFBTSxDQUFDQyxZQUFYLEVBQXlCO0FBQ3ZCRCxNQUFBQSxNQUFNLENBQUNmLGNBQVAsR0FBd0JlLE1BQU0sQ0FBQ0MsWUFBL0I7QUFDQSxhQUFPRCxNQUFNLENBQUNDLFlBQWQ7QUFDRDs7QUFDRCxRQUFJRCxNQUFNLENBQUNFLFlBQVgsRUFBeUI7QUFDdkJGLE1BQUFBLE1BQU0sQ0FBQzNCLEtBQVAsR0FBZSxLQUFmO0FBQ0EsYUFBTzJCLE1BQU0sQ0FBQ0UsWUFBZDtBQUNEOztBQUNELFFBQUlGLE1BQU0sQ0FBQ0csTUFBWCxFQUFtQjtBQUNqQkgsTUFBQUEsTUFBTSxDQUFDSSxZQUFQLEdBQXNCLElBQXRCO0FBQ0Q7O0FBRUQsU0FBS0osTUFBTCxHQUFjbkIsQ0FBQyxDQUFDd0IsS0FBRixDQUNaO0FBQ0VDLE1BQUFBLEtBQUssRUFBRTtBQUNMO0FBQ0FDLFFBQUFBLElBQUksRUFBRW5DLElBQUksQ0FBQ2dCLE9BQUwsQ0FBYSxRQUFiLENBRkQ7QUFHTEQsUUFBQUEsT0FBTyxFQUFFO0FBQ1A7QUFDQXFCLFVBQUFBLFNBQVMsRUFBRSxLQUZKO0FBR1BDLFVBQUFBLEdBQUcsRUFBRTtBQUNIQyxZQUFBQSxHQUFHLEVBQUUsWUFERjtBQUVIQyxZQUFBQSxHQUFHLEVBQUU7QUFGRixXQUhFO0FBT1BDLFVBQUFBLFlBQVksRUFBRWpDO0FBUFAsU0FISjtBQVlMO0FBQ0FrQyxRQUFBQSxNQUFNLEVBQUU7QUFDTjtBQUNBQyxVQUFBQSxNQUFNLEVBQUU7QUFGRjtBQWJILE9BRFQ7QUFtQkU7QUFDQUMsTUFBQUEsT0FBTyxFQUFFLEVBcEJYO0FBcUJFQyxNQUFBQSxJQUFJLEVBQUUsQ0FBQyxDQUFDLGFBQUQsRUFBZ0IsTUFBaEIsRUFBd0JDLFFBQXhCLENBQWlDMUIsR0FBakMsQ0FyQlQ7QUFzQkUyQixNQUFBQSxPQUFPLEVBQUUzQixHQUFHLEtBQUssYUF0Qm5CO0FBdUJFO0FBQ0E7QUFDQTRCLE1BQUFBLElBQUksRUFBRSxLQXpCUjtBQTBCRTtBQUNBaEIsTUFBQUEsTUFBTSxFQUFFLEtBQUtBLE1BQUwsQ0FBWWlCLElBQVosQ0FBaUIsSUFBakIsQ0EzQlY7QUE0QkVoQixNQUFBQSxZQUFZLEVBQUUsS0E1QmhCO0FBNkJFO0FBQ0FpQixNQUFBQSxRQUFRLEVBQUUsS0E5Qlo7QUErQkU7QUFDQTlDLE1BQUFBLFVBQVUsRUFBRTtBQUNWK0MsUUFBQUEsV0FBVyxFQUFFO0FBREgsT0FoQ2Q7QUFtQ0VDLE1BQUFBLGFBQWEsRUFBRSxLQW5DakI7QUFvQ0U7QUFDQWxELE1BQUFBLEtBQUssRUFBRSxJQXJDVDtBQXNDRVksTUFBQUEsY0FBYyxFQUFFO0FBQ2R1QyxRQUFBQSxpQkFBaUIsRUFBRSxJQURMO0FBRWRDLFFBQUFBLFlBQVksRUFBRTtBQUNaQyxVQUFBQSxVQUFVLEVBQUV0RCxJQUFJLENBQUNnQixPQUFMLENBQWEsT0FBYixDQURBO0FBRVp1QyxVQUFBQSxNQUFNLEVBQUU7QUFGSTtBQUZBLE9BdENsQjtBQTZDRTtBQUNBO0FBQ0E7QUFDQUMsTUFBQUEsU0FBUyxFQUFFO0FBaERiLEtBRFksRUFtRFo1QixNQW5EWSxDQUFkLENBaEJ1QixDQXNFdkI7O0FBQ0EsU0FBS0csTUFBTCxHQUFjLEtBQUtILE1BQUwsQ0FBWUcsTUFBMUI7QUFFQSxRQUFJLENBQUN0QixDQUFDLENBQUNnRCxVQUFGLENBQWEsS0FBSzdCLE1BQUwsQ0FBWTRCLFNBQVosQ0FBc0JFLFFBQW5DLENBQUwsRUFDRSxLQUFLOUIsTUFBTCxDQUFZNEIsU0FBWixHQUF3QmxELFVBQVUsQ0FBQ3FELGVBQVgsQ0FBMkIsS0FBSy9CLE1BQUwsQ0FBWTRCLFNBQXZDLENBQXhCO0FBRUZ0RCxJQUFBQSxLQUFLLENBQUMsdUJBQUQsRUFBMEIsS0FBSzBCLE1BQS9CLENBQUw7QUFFQXZCLElBQUFBLFFBQVEsQ0FBQyxJQUFELENBQVI7QUFDRCxHQWhGUyxDQWtGVjtBQUNBOzs7QUFDQVEsRUFBQUEsY0FBYyxDQUFDQyxJQUFELEVBQU87QUFDbkIsV0FBT0QsY0FBYyxDQUFDQyxJQUFELEVBQU8sS0FBS2MsTUFBTCxDQUFZZixjQUFuQixDQUFyQjtBQUNELEdBdEZTLENBd0ZWOzs7QUFDTStDLEVBQUFBLGVBQU4sQ0FBc0JDLFFBQXRCLEVBQWdDO0FBQUE7O0FBQUE7QUFBQSxtQkFDVDdELElBQUksQ0FBQzhELFVBQUwsQ0FBZ0JELFFBQWhCLElBQ2pCLENBQUM3RCxJQUFJLENBQUMrRCxPQUFMLENBQWFGLFFBQWIsQ0FBRCxFQUF5QjdELElBQUksQ0FBQ2dFLFFBQUwsQ0FBY0gsUUFBZCxDQUF6QixDQURpQixHQUVqQixDQUFDLEtBQUksQ0FBQ2pDLE1BQUwsQ0FBWU0sS0FBWixDQUFrQkMsSUFBbkIsRUFBeUIwQixRQUF6QixDQUgwQjtBQUFBO0FBQUEsWUFDdkIxQixJQUR1QjtBQUFBLFlBQ2pCOEIsSUFEaUI7O0FBSTlCLFlBQU1DLEtBQUssU0FBU3RELFFBQVEsQ0FDMUJ1QixJQUQwQixFQUUxQjhCLElBRjBCLEVBRzFCLEtBQUksQ0FBQ3JDLE1BQUwsQ0FBWU0sS0FBWixDQUFrQm5CLE9BQWxCLENBQTBCcUIsU0FIQSxDQUE1QjtBQUtBLFlBQU0rQixRQUFRLEdBQUduRSxJQUFJLENBQUNnQixPQUFMLENBQWFtQixJQUFiLEVBQW1CK0IsS0FBSyxDQUFDRSxHQUF6QixDQUFqQjtBQUNBLGFBQU87QUFBRUQsUUFBQUEsUUFBRjtBQUFZRCxRQUFBQTtBQUFaLE9BQVA7QUFWOEI7QUFXL0IsR0FwR1MsQ0FzR1Y7QUFDQTs7O0FBQ01HLEVBQUFBLGNBQU4sQ0FBcUJKLElBQXJCLEVBQTJCO0FBQUE7O0FBQUE7QUFDekIsVUFBSTtBQUFBLDRCQUN5QixNQUFJLENBQUNMLGVBQUwsQ0FBcUJLLElBQXJCLENBRHpCO0FBQUEsY0FDTUUsUUFETixTQUNNQSxRQUROOztBQUVGLGNBQU1HLEtBQUssU0FBUy9DLElBQUksQ0FBQzRDLFFBQUQsQ0FBeEI7QUFDQSxZQUFJLENBQUNHLEtBQUssQ0FBQ0MsTUFBTixFQUFMLEVBQXFCLE1BQU0sSUFBSUMsS0FBSixDQUFXLEdBQUVMLFFBQVMsaUJBQXRCLENBQU47QUFDckIsZUFBTyxJQUFQO0FBQ0QsT0FMRCxDQUtFLE9BQU9qRCxHQUFQLEVBQVk7QUFDWmhCLFFBQUFBLEtBQUssQ0FBQyxnQkFBRCxFQUFtQmdCLEdBQW5CLENBQUw7QUFDQSxlQUFPLEtBQVA7QUFDRDtBQVR3QjtBQVUxQixHQWxIUyxDQW9IVjtBQUNBO0FBQ0E7OztBQUNNYSxFQUFBQSxNQUFOLENBQWFrQyxJQUFiLEVBQW1CeEIsTUFBTSxHQUFHLEVBQTVCLEVBQWdDO0FBQUE7O0FBQUE7QUFBQSxvQ0FDQSxNQUFJLENBQUNiLE1BQUwsQ0FBWU0sS0FBWixDQUFrQm5CLE9BRGxCO0FBQUEsWUFDdEJzQixHQURzQix5QkFDdEJBLEdBRHNCO0FBQUEsWUFDakJHLFlBRGlCLHlCQUNqQkEsWUFEaUI7O0FBQUEsMEJBRUksTUFBSSxDQUFDb0IsZUFBTCxDQUFxQkssSUFBckIsQ0FGSjtBQUFBLFlBRXRCRSxRQUZzQixTQUV0QkEsUUFGc0I7QUFBQSxZQUVaRCxLQUZZLFNBRVpBLEtBRlk7O0FBRzlCLFVBQUlBLEtBQUssQ0FBQ08sR0FBTixLQUFjLE1BQWQsSUFBd0IsQ0FBQ3BDLEdBQTdCLEVBQWtDO0FBQ2hDLGNBQU1xQyxHQUFHLFNBQVNqRCxRQUFRLENBQUMwQyxRQUFELEVBQVcsTUFBWCxDQUExQjtBQUNBLGVBQU9PLEdBQVA7QUFDRDs7QUFDRCxZQUFNQyxVQUFVLEdBQUd0QyxHQUFHLElBQUlBLEdBQUcsQ0FBQzZCLEtBQUssQ0FBQ08sR0FBUCxDQUFWLEdBQXdCcEMsR0FBRyxDQUFDNkIsS0FBSyxDQUFDTyxHQUFQLENBQTNCLEdBQXlDUCxLQUFLLENBQUNPLEdBQWxFO0FBQ0EsWUFBTUcsUUFBUSxHQUFHcEMsWUFBWSxDQUFDbUMsVUFBRCxDQUE3QjtBQUNBLFVBQUksQ0FBQ0EsVUFBRCxJQUFlLENBQUNDLFFBQXBCLEVBQ0UsTUFBTSxJQUFJSixLQUFKLENBQ0gsOEJBQTZCTixLQUFLLENBQUNPLEdBQUksa0JBRHBDLENBQU47O0FBSUYsVUFBSWhFLENBQUMsQ0FBQ29FLFFBQUYsQ0FBVyxNQUFJLENBQUNqRCxNQUFMLENBQVltQixJQUF2QixDQUFKLEVBQWtDO0FBQ2hDLGNBQU1BLElBQUksR0FBRyxJQUFJM0MsSUFBSixDQUNYMEUsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQixNQUFJLENBQUNuRCxNQUFMLENBQVltQixJQUE5QixFQUFvQztBQUNsQ2lDLFVBQUFBLFFBQVEsRUFBRXZDO0FBRHdCLFNBQXBDLENBRFcsQ0FBYixDQURnQyxDQU9oQztBQUNBOztBQUNBLFlBQUloQyxDQUFDLENBQUNvRSxRQUFGLENBQVdwQyxNQUFNLENBQUN3QyxJQUFsQixLQUEyQnhFLENBQUMsQ0FBQ3lFLFFBQUYsQ0FBV3pDLE1BQU0sQ0FBQ3dDLElBQVAsQ0FBWUUsV0FBdkIsQ0FBL0IsRUFDRTFDLE1BQU0sQ0FBQzJDLE1BQVAsR0FBZ0IzQyxNQUFNLENBQUN3QyxJQUFQLENBQVlFLFdBQTVCO0FBRUYsWUFBSTFFLENBQUMsQ0FBQ3lFLFFBQUYsQ0FBV3pDLE1BQU0sQ0FBQzJDLE1BQWxCLENBQUosRUFBK0JyQyxJQUFJLENBQUNzQyxTQUFMLENBQWU1QyxNQUFNLENBQUMyQyxNQUF0QjtBQUNoQzs7QUFFRCxZQUFNVixHQUFHLFNBQVNoRSxRQUFPLENBQUNjLFNBQVIsQ0FBa0JvRCxRQUFsQixFQUE0QlQsUUFBNUIsRUFBc0MxQixNQUF0QyxDQUFsQixDQTdCOEIsQ0E4QjlCO0FBQ0E7QUFDQTs7QUFDQSxVQUFJLENBQUMsTUFBSSxDQUFDYixNQUFMLENBQVkzQixLQUFqQixFQUF3QixPQUFPeUUsR0FBUDtBQUN4QixZQUFNNUQsSUFBSSxTQUFTLE1BQUksQ0FBQ0QsY0FBTCxDQUFvQjZELEdBQXBCLENBQW5CO0FBQ0EsYUFBTzVELElBQVA7QUFuQzhCO0FBb0MvQixHQTNKUyxDQTZKVjtBQUNBOzs7QUFDTXdFLEVBQUFBLFNBQU4sQ0FBZ0J6QixRQUFoQixFQUEwQnBCLE1BQU0sR0FBRyxFQUFuQyxFQUF1Q0UsT0FBTyxHQUFHLEVBQWpELEVBQXFEO0FBQUE7O0FBQUE7QUFDbkQsVUFBSTRDLHFCQUFxQixHQUFHLE1BQUksQ0FBQzNELE1BQUwsQ0FBWUksWUFBeEM7QUFDQSxVQUFJd0Qsa0JBQWtCLEdBQUcsTUFBSSxDQUFDNUQsTUFBTCxDQUFZSSxZQUFyQztBQUNBLFVBQUl5RCxrQkFBa0IsR0FBRyxNQUFJLENBQUM3RCxNQUFMLENBQVlJLFlBQXJDOztBQUVBLFVBQUk2QixRQUFRLElBQUksQ0FBQyxNQUFJLENBQUNqQyxNQUFMLENBQVlJLFlBQTdCO0FBQUEsMEJBS1l0QixRQUFPLENBQUNnRixHQUFSLENBQVksQ0FDcEIsTUFBSSxDQUFDckIsY0FBTCxDQUFxQixHQUFFUixRQUFTLFVBQWhDLENBRG9CLEVBRXBCLE1BQUksQ0FBQ1EsY0FBTCxDQUFxQixHQUFFUixRQUFTLE9BQWhDLENBRm9CLEVBR3BCLE1BQUksQ0FBQ1EsY0FBTCxDQUFxQixHQUFFUixRQUFTLE9BQWhDLENBSG9CLENBQVosQ0FMWjs7QUFBQTs7QUFFSTBCLFFBQUFBLHFCQUZKO0FBR0lDLFFBQUFBLGtCQUhKO0FBSUlDLFFBQUFBLGtCQUpKO0FBQUE7O0FBV0EsVUFBSSxDQUFDOUMsT0FBTyxDQUFDZ0QsT0FBVCxJQUFvQkoscUJBQXhCLEVBQStDO0FBQzdDNUMsUUFBQUEsT0FBTyxDQUFDZ0QsT0FBUixTQUF3QixNQUFJLENBQUM1RCxNQUFMLENBQ3JCLEdBQUU4QixRQUFTLFVBRFUsRUFFdEJpQixNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCdEMsTUFBbEIsRUFBMEI7QUFBRUMsVUFBQUEsTUFBTSxFQUFFO0FBQVYsU0FBMUIsQ0FGc0IsQ0FBeEI7QUFJQUMsUUFBQUEsT0FBTyxDQUFDZ0QsT0FBUixHQUFrQmhELE9BQU8sQ0FBQ2dELE9BQVIsQ0FBZ0JDLElBQWhCLEVBQWxCO0FBQ0Q7O0FBRUQsVUFBSWpELE9BQU8sQ0FBQ2dELE9BQVIsSUFBbUIsTUFBSSxDQUFDL0QsTUFBTCxDQUFZdUIsYUFBbkMsRUFDRVIsT0FBTyxDQUFDZ0QsT0FBUixHQUFrQixNQUFJLENBQUMvRCxNQUFMLENBQVl1QixhQUFaLEdBQTRCUixPQUFPLENBQUNnRCxPQUF0RDtBQUVGLFVBQUksQ0FBQ2hELE9BQU8sQ0FBQzdCLElBQVQsSUFBaUIwRSxrQkFBckIsRUFDRTdDLE9BQU8sQ0FBQzdCLElBQVIsU0FBcUIsTUFBSSxDQUFDaUIsTUFBTCxDQUFhLEdBQUU4QixRQUFTLE9BQXhCLEVBQWdDcEIsTUFBaEMsQ0FBckI7QUFFRixVQUFJLENBQUNFLE9BQU8sQ0FBQ2tELElBQVQsSUFBaUJKLGtCQUFyQixFQUNFOUMsT0FBTyxDQUFDa0QsSUFBUixTQUFxQixNQUFJLENBQUM5RCxNQUFMLENBQ2xCLEdBQUU4QixRQUFTLE9BRE8sRUFFbkJpQixNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCdEMsTUFBbEIsRUFBMEI7QUFBRUMsUUFBQUEsTUFBTSxFQUFFO0FBQVYsT0FBMUIsQ0FGbUIsQ0FBckI7QUFLRixVQUFJLE1BQUksQ0FBQ2QsTUFBTCxDQUFZekIsVUFBWixJQUEwQndDLE9BQU8sQ0FBQzdCLElBQWxDLElBQTBDLENBQUM2QixPQUFPLENBQUNrRCxJQUF2RCxFQUNFO0FBQ0E7QUFDQTtBQUNBbEQsUUFBQUEsT0FBTyxDQUFDa0QsSUFBUixHQUFlMUYsVUFBVSxDQUFDMkYsVUFBWCxDQUNibkQsT0FBTyxDQUFDN0IsSUFESyxFQUViLE1BQUksQ0FBQ2MsTUFBTCxDQUFZekIsVUFGQyxDQUFmLENBeENpRCxDQTZDbkQ7O0FBQ0EsVUFBSSxNQUFJLENBQUN5QixNQUFMLENBQVlxQixRQUFoQixFQUEwQixPQUFPTixPQUFPLENBQUM3QixJQUFmLENBOUN5QixDQWdEbkQ7QUFDQTtBQUNBOztBQUNBLFVBQ0VILENBQUMsQ0FBQ29GLE9BQUYsQ0FBVXBELE9BQU8sQ0FBQ2dELE9BQWxCLEtBQ0FoRixDQUFDLENBQUNvRixPQUFGLENBQVVwRCxPQUFPLENBQUNrRCxJQUFsQixDQURBLElBRUFsRixDQUFDLENBQUNvRixPQUFGLENBQVVwRCxPQUFPLENBQUM3QixJQUFsQixDQUZBLElBR0FMLENBQUMsQ0FBQ3VGLE9BQUYsQ0FBVXJELE9BQU8sQ0FBQ3NELFdBQWxCLENBSEEsSUFJQXhGLENBQUMsQ0FBQ3lGLE9BQUYsQ0FBVXZELE9BQU8sQ0FBQ3NELFdBQWxCLENBTEYsRUFPRSxNQUFNLElBQUl6QixLQUFKLENBQ0gsd0hBQXVIWCxRQUFTLFVBRDdILENBQU47QUFJRixhQUFPbEIsT0FBUDtBQTlEbUQ7QUErRHBEOztBQUVLQyxFQUFBQSxJQUFOLENBQVc3QixPQUFPLEdBQUcsRUFBckIsRUFBeUI7QUFBQTs7QUFBQTtBQUN2QkEsTUFBQUEsT0FBTyxHQUFHK0QsTUFBTSxDQUFDQyxNQUFQLENBQ1I7QUFDRWxCLFFBQUFBLFFBQVEsRUFBRSxFQURaO0FBRUVsQixRQUFBQSxPQUFPLEVBQUUsRUFGWDtBQUdFRixRQUFBQSxNQUFNLEVBQUU7QUFIVixPQURRLEVBTVIxQixPQU5RLENBQVY7QUFEdUIscUJBVWFBLE9BVmI7QUFBQSxVQVVqQjhDLFFBVmlCLFlBVWpCQSxRQVZpQjtBQUFBLFVBVVBsQixPQVZPLFlBVVBBLE9BVk87QUFBQSxVQVVFRixNQVZGLFlBVUVBLE1BVkY7QUFZdkIsWUFBTXdELFdBQVcsR0FDZnRELE9BQU8sQ0FBQ3NELFdBQVIsSUFBdUIsTUFBSSxDQUFDckUsTUFBTCxDQUFZZSxPQUFaLENBQW9Cc0QsV0FBM0MsSUFBMEQsRUFENUQ7QUFHQXRELE1BQUFBLE9BQU8sR0FBR2xDLENBQUMsQ0FBQzBGLFlBQUYsQ0FDUixFQURRLEVBRVIxRixDQUFDLENBQUMyRixJQUFGLENBQU96RCxPQUFQLEVBQWdCLGFBQWhCLENBRlEsRUFHUmxDLENBQUMsQ0FBQzJGLElBQUYsQ0FBTyxNQUFJLENBQUN4RSxNQUFMLENBQVllLE9BQW5CLEVBQTRCLGFBQTVCLENBSFEsQ0FBVjtBQUtBRixNQUFBQSxNQUFNLEdBQUdoQyxDQUFDLENBQUMwRixZQUFGLENBQWUsRUFBZixFQUFtQixNQUFJLENBQUN2RSxNQUFMLENBQVlNLEtBQVosQ0FBa0JPLE1BQXJDLEVBQTZDQSxNQUE3QyxDQUFUO0FBRUEsVUFBSXdELFdBQUosRUFBaUJ0RCxPQUFPLENBQUNzRCxXQUFSLEdBQXNCQSxXQUF0QjtBQUVqQi9GLE1BQUFBLEtBQUssQ0FBQyxhQUFELEVBQWdCMkQsUUFBaEIsQ0FBTDtBQUNBM0QsTUFBQUEsS0FBSyxDQUFDLFlBQUQsRUFBZXlDLE9BQWYsQ0FBTDtBQUNBekMsTUFBQUEsS0FBSyxDQUFDLHdCQUFELEVBQTJCNEUsTUFBTSxDQUFDdUIsSUFBUCxDQUFZNUQsTUFBWixDQUEzQixDQUFMLENBMUJ1QixDQTRCdkI7O0FBQ0EsWUFBTTZELEdBQUcsU0FBUyxNQUFJLENBQUNoQixTQUFMLENBQWV6QixRQUFmLEVBQXlCcEIsTUFBekIsRUFBaUNFLE9BQWpDLENBQWxCLENBN0J1QixDQStCdkI7O0FBQ0FtQyxNQUFBQSxNQUFNLENBQUNDLE1BQVAsQ0FBY3BDLE9BQWQsRUFBdUIyRCxHQUF2Qjs7QUFFQSxVQUFJLE1BQUksQ0FBQzFFLE1BQUwsQ0FBWWtCLE9BQWhCLEVBQXlCO0FBQ3ZCNUMsUUFBQUEsS0FBSyxDQUFDLHdDQUFELENBQUw7QUFDQSxjQUFNTSxZQUFZLENBQUNtQyxPQUFELENBQWxCO0FBQ0Q7O0FBRUQsVUFBSSxDQUFDLE1BQUksQ0FBQ2YsTUFBTCxDQUFZZ0IsSUFBakIsRUFBdUI7QUFDckIxQyxRQUFBQSxLQUFLLENBQUMsZ0RBQUQsQ0FBTCxDQURxQixDQUVyQjtBQUNBOztBQUNBLFFBQUEsTUFBSSxDQUFDMEIsTUFBTCxDQUFZNEIsU0FBWixHQUF3QmxELFVBQVUsQ0FBQ3FELGVBQVgsQ0FBMkI7QUFDakQ0QyxVQUFBQSxhQUFhLEVBQUU7QUFEa0MsU0FBM0IsQ0FBeEI7QUFHRDs7QUFFRCxZQUFNN0IsR0FBRyxTQUFTLE1BQUksQ0FBQzlDLE1BQUwsQ0FBWTRCLFNBQVosQ0FBc0JFLFFBQXRCLENBQStCZixPQUEvQixDQUFsQjtBQUNBekMsTUFBQUEsS0FBSyxDQUFDLGNBQUQsQ0FBTDtBQUNBd0UsTUFBQUEsR0FBRyxDQUFDOEIsZUFBSixHQUFzQjdELE9BQXRCO0FBQ0EsYUFBTytCLEdBQVA7QUFuRHVCO0FBb0R4Qjs7QUFwUlM7O0FBdVJaK0IsTUFBTSxDQUFDQyxPQUFQLEdBQWlCaEYsS0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QganVpY2UgPSByZXF1aXJlKCdqdWljZScpO1xuY29uc3QgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCdlbWFpbC10ZW1wbGF0ZXMnKTtcbmNvbnN0IGh0bWxUb1RleHQgPSByZXF1aXJlKCdodG1sLXRvLXRleHQnKTtcbmNvbnN0IEkxOE4gPSByZXF1aXJlKCdAbGFkanMvaTE4bicpO1xuY29uc3QgYXV0b0JpbmQgPSByZXF1aXJlKCdhdXRvLWJpbmQnKTtcbmNvbnN0IG5vZGVtYWlsZXIgPSByZXF1aXJlKCdub2RlbWFpbGVyJyk7XG5jb25zdCBjb25zb2xpZGF0ZSA9IHJlcXVpcmUoJ2NvbnNvbGlkYXRlJyk7XG5jb25zdCBwcmV2aWV3RW1haWwgPSByZXF1aXJlKCdwcmV2aWV3LWVtYWlsJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbmNvbnN0IHMgPSByZXF1aXJlKCd1bmRlcnNjb3JlLnN0cmluZycpO1xuXG5jb25zdCBnZXRQYXRocyA9IHJlcXVpcmUoJ2dldC1wYXRocycpO1xuXG4vLyBwcm9taXNlIHZlcnNpb24gb2YgYGp1aWNlLmp1aWNlUmVzb3VyY2VzYFxuY29uc3QganVpY2VSZXNvdXJjZXMgPSAoaHRtbCwgb3B0aW9ucykgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGp1aWNlLmp1aWNlUmVzb3VyY2VzKGh0bWwsIG9wdGlvbnMsIChlcnIsIGh0bWwpID0+IHtcbiAgICAgIGlmIChlcnIpIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIHJlc29sdmUoaHRtbCk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuY29uc3QgZW52ID0gKHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCcpLnRvTG93ZXJDYXNlKCk7XG5jb25zdCBzdGF0ID0gUHJvbWlzZS5wcm9taXNpZnkoZnMuc3RhdCk7XG5jb25zdCByZWFkRmlsZSA9IFByb21pc2UucHJvbWlzaWZ5KGZzLnJlYWRGaWxlKTtcblxuY2xhc3MgRW1haWwge1xuICBjb25zdHJ1Y3Rvcihjb25maWcgPSB7fSkge1xuICAgIGRlYnVnKCdjb25maWcgcGFzc2VkICVPJywgY29uZmlnKTtcblxuICAgIC8vIDIueCBiYWNrd2FyZHMgY29tcGF0aWJsZSBzdXBwb3J0XG4gICAgaWYgKGNvbmZpZy5qdWljZU9wdGlvbnMpIHtcbiAgICAgIGNvbmZpZy5qdWljZVJlc291cmNlcyA9IGNvbmZpZy5qdWljZU9wdGlvbnM7XG4gICAgICBkZWxldGUgY29uZmlnLmp1aWNlT3B0aW9ucztcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5kaXNhYmxlSnVpY2UpIHtcbiAgICAgIGNvbmZpZy5qdWljZSA9IGZhbHNlO1xuICAgICAgZGVsZXRlIGNvbmZpZy5kaXNhYmxlSnVpY2U7XG4gICAgfVxuICAgIGlmIChjb25maWcucmVuZGVyKSB7XG4gICAgICBjb25maWcuY3VzdG9tUmVuZGVyID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbmZpZyA9IF8ubWVyZ2UoXG4gICAgICB7XG4gICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgLy8gZGlyZWN0b3J5IHdoZXJlIGVtYWlsIHRlbXBsYXRlcyByZXNpZGVcbiAgICAgICAgICByb290OiBwYXRoLnJlc29sdmUoJ2VtYWlscycpLFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIC8vIGRlZmF1bHQgZmlsZSBleHRlbnNpb24gZm9yIHRlbXBsYXRlXG4gICAgICAgICAgICBleHRlbnNpb246ICdwdWcnLFxuICAgICAgICAgICAgbWFwOiB7XG4gICAgICAgICAgICAgIGhiczogJ2hhbmRsZWJhcnMnLFxuICAgICAgICAgICAgICBuams6ICdudW5qdWNrcydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmdpbmVTb3VyY2U6IGNvbnNvbGlkYXRlXG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBsb2NhbHMgdG8gcGFzcyB0byB0ZW1wbGF0ZXMgZm9yIHJlbmRlcmluZ1xuICAgICAgICAgIGxvY2Fsczoge1xuICAgICAgICAgICAgLy8gcHJldHR5IGlzIGF1dG9tYXRpY2FsbHkgc2V0IHRvIGBmYWxzZWAgZm9yIHN1YmplY3QvdGV4dFxuICAgICAgICAgICAgcHJldHR5OiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyA8aHR0cHM6Ly9ub2RlbWFpbGVyLmNvbS9tZXNzYWdlLz5cbiAgICAgICAgbWVzc2FnZToge30sXG4gICAgICAgIHNlbmQ6ICFbJ2RldmVsb3BtZW50JywgJ3Rlc3QnXS5pbmNsdWRlcyhlbnYpLFxuICAgICAgICBwcmV2aWV3OiBlbnYgPT09ICdkZXZlbG9wbWVudCcsXG4gICAgICAgIC8vIDxodHRwczovL2dpdGh1Yi5jb20vbGFkanMvaTE4bj5cbiAgICAgICAgLy8gc2V0IHRvIGFuIG9iamVjdCB0byBjb25maWd1cmUgYW5kIGVuYWJsZSBpdFxuICAgICAgICBpMThuOiBmYWxzZSxcbiAgICAgICAgLy8gcGFzcyBhIGN1c3RvbSByZW5kZXIgZnVuY3Rpb24gaWYgbmVjZXNzYXJ5XG4gICAgICAgIHJlbmRlcjogdGhpcy5yZW5kZXIuYmluZCh0aGlzKSxcbiAgICAgICAgY3VzdG9tUmVuZGVyOiBmYWxzZSxcbiAgICAgICAgLy8gZm9yY2UgdGV4dC1vbmx5IHJlbmRlcmluZyBvZiB0ZW1wbGF0ZSAoZGlzcmVnYXJkcyB0ZW1wbGF0ZSBmb2xkZXIpXG4gICAgICAgIHRleHRPbmx5OiBmYWxzZSxcbiAgICAgICAgLy8gPGh0dHBzOi8vZ2l0aHViLmNvbS93ZXJrODUvbm9kZS1odG1sLXRvLXRleHQ+XG4gICAgICAgIGh0bWxUb1RleHQ6IHtcbiAgICAgICAgICBpZ25vcmVJbWFnZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBzdWJqZWN0UHJlZml4OiBmYWxzZSxcbiAgICAgICAgLy8gPGh0dHBzOi8vZ2l0aHViLmNvbS9BdXRvbWF0dGljL2p1aWNlPlxuICAgICAgICBqdWljZTogdHJ1ZSxcbiAgICAgICAganVpY2VSZXNvdXJjZXM6IHtcbiAgICAgICAgICBwcmVzZXJ2ZUltcG9ydGFudDogdHJ1ZSxcbiAgICAgICAgICB3ZWJSZXNvdXJjZXM6IHtcbiAgICAgICAgICAgIHJlbGF0aXZlVG86IHBhdGgucmVzb2x2ZSgnYnVpbGQnKSxcbiAgICAgICAgICAgIGltYWdlczogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHBhc3MgYSB0cmFuc3BvcnQgY29uZmlndXJhdGlvbiBvYmplY3Qgb3IgYSB0cmFuc3BvcnQgaW5zdGFuY2VcbiAgICAgICAgLy8gKGUuZy4gYW4gaW5zdGFuY2UgaXMgY3JlYXRlZCB2aWEgYG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0YClcbiAgICAgICAgLy8gPGh0dHBzOi8vbm9kZW1haWxlci5jb20vdHJhbnNwb3J0cy8+XG4gICAgICAgIHRyYW5zcG9ydDoge31cbiAgICAgIH0sXG4gICAgICBjb25maWdcbiAgICApO1xuXG4gICAgLy8gb3ZlcnJpZGUgZXhpc3RpbmcgbWV0aG9kXG4gICAgdGhpcy5yZW5kZXIgPSB0aGlzLmNvbmZpZy5yZW5kZXI7XG5cbiAgICBpZiAoIV8uaXNGdW5jdGlvbih0aGlzLmNvbmZpZy50cmFuc3BvcnQuc2VuZE1haWwpKVxuICAgICAgdGhpcy5jb25maWcudHJhbnNwb3J0ID0gbm9kZW1haWxlci5jcmVhdGVUcmFuc3BvcnQodGhpcy5jb25maWcudHJhbnNwb3J0KTtcblxuICAgIGRlYnVnKCd0cmFuc2Zvcm1lZCBjb25maWcgJU8nLCB0aGlzLmNvbmZpZyk7XG5cbiAgICBhdXRvQmluZCh0aGlzKTtcbiAgfVxuXG4gIC8vIHNob3J0aGFuZCB1c2Ugb2YgYGp1aWNlUmVzb3VyY2VzYCB3aXRoIHRoZSBjb25maWdcbiAgLy8gKG1haW5seSBmb3IgY3VzdG9tIHJlbmRlcnMgbGlrZSBmcm9tIGEgZGF0YWJhc2UpXG4gIGp1aWNlUmVzb3VyY2VzKGh0bWwpIHtcbiAgICByZXR1cm4ganVpY2VSZXNvdXJjZXMoaHRtbCwgdGhpcy5jb25maWcuanVpY2VSZXNvdXJjZXMpO1xuICB9XG5cbiAgLy8gYSBzaW1wbGUgaGVscGVyIGZ1bmN0aW9uIHRoYXQgZ2V0cyB0aGUgYWN0dWFsIGZpbGUgcGF0aCBmb3IgdGhlIHRlbXBsYXRlXG4gIGFzeW5jIGdldFRlbXBsYXRlUGF0aCh0ZW1wbGF0ZSkge1xuICAgIGNvbnN0IFtyb290LCB2aWV3XSA9IHBhdGguaXNBYnNvbHV0ZSh0ZW1wbGF0ZSlcbiAgICAgID8gW3BhdGguZGlybmFtZSh0ZW1wbGF0ZSksIHBhdGguYmFzZW5hbWUodGVtcGxhdGUpXVxuICAgICAgOiBbdGhpcy5jb25maWcudmlld3Mucm9vdCwgdGVtcGxhdGVdO1xuICAgIGNvbnN0IHBhdGhzID0gYXdhaXQgZ2V0UGF0aHMoXG4gICAgICByb290LFxuICAgICAgdmlldyxcbiAgICAgIHRoaXMuY29uZmlnLnZpZXdzLm9wdGlvbnMuZXh0ZW5zaW9uXG4gICAgKTtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShyb290LCBwYXRocy5yZWwpO1xuICAgIHJldHVybiB7IGZpbGVQYXRoLCBwYXRocyB9O1xuICB9XG5cbiAgLy8gcmV0dXJucyB0cnVlIG9yIGZhbHNlIGlmIGEgdGVtcGxhdGUgZXhpc3RzXG4gIC8vICh1c2VzIHNhbWUgbG9vay11cCBhcHByb2FjaCBhcyBgcmVuZGVyYCBmdW5jdGlvbilcbiAgYXN5bmMgdGVtcGxhdGVFeGlzdHModmlldykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGZpbGVQYXRoIH0gPSBhd2FpdCB0aGlzLmdldFRlbXBsYXRlUGF0aCh2aWV3KTtcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc3RhdChmaWxlUGF0aCk7XG4gICAgICBpZiAoIXN0YXRzLmlzRmlsZSgpKSB0aHJvdyBuZXcgRXJyb3IoYCR7ZmlsZVBhdGh9IHdhcyBub3QgYSBmaWxlYCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGRlYnVnKCd0ZW1wbGF0ZUV4aXN0cycsIGVycik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gcHJvbWlzZSB2ZXJzaW9uIG9mIGNvbnNvbGlkYXRlJ3MgcmVuZGVyXG4gIC8vIGluc3BpcmVkIGJ5IGtvYS12aWV3cyBhbmQgcmUtdXNlcyB0aGUgc2FtZSBjb25maWdcbiAgLy8gPGh0dHBzOi8vZ2l0aHViLmNvbS9xdWVja2V6ei9rb2Etdmlld3M+XG4gIGFzeW5jIHJlbmRlcih2aWV3LCBsb2NhbHMgPSB7fSkge1xuICAgIGNvbnN0IHsgbWFwLCBlbmdpbmVTb3VyY2UgfSA9IHRoaXMuY29uZmlnLnZpZXdzLm9wdGlvbnM7XG4gICAgY29uc3QgeyBmaWxlUGF0aCwgcGF0aHMgfSA9IGF3YWl0IHRoaXMuZ2V0VGVtcGxhdGVQYXRoKHZpZXcpO1xuICAgIGlmIChwYXRocy5leHQgPT09ICdodG1sJyAmJiAhbWFwKSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZWFkRmlsZShmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIGNvbnN0IGVuZ2luZU5hbWUgPSBtYXAgJiYgbWFwW3BhdGhzLmV4dF0gPyBtYXBbcGF0aHMuZXh0XSA6IHBhdGhzLmV4dDtcbiAgICBjb25zdCByZW5kZXJGbiA9IGVuZ2luZVNvdXJjZVtlbmdpbmVOYW1lXTtcbiAgICBpZiAoIWVuZ2luZU5hbWUgfHwgIXJlbmRlckZuKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRW5naW5lIG5vdCBmb3VuZCBmb3IgdGhlIFwiLiR7cGF0aHMuZXh0fVwiIGZpbGUgZXh0ZW5zaW9uYFxuICAgICAgKTtcblxuICAgIGlmIChfLmlzT2JqZWN0KHRoaXMuY29uZmlnLmkxOG4pKSB7XG4gICAgICBjb25zdCBpMThuID0gbmV3IEkxOE4oXG4gICAgICAgIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29uZmlnLmkxOG4sIHtcbiAgICAgICAgICByZWdpc3RlcjogbG9jYWxzXG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICAvLyBzdXBwb3J0IGBsb2NhbHMudXNlci5sYXN0X2xvY2FsZWBcbiAgICAgIC8vIChlLmcuIGZvciA8aHR0cHM6Ly9sYWQuanMub3JnPilcbiAgICAgIGlmIChfLmlzT2JqZWN0KGxvY2Fscy51c2VyKSAmJiBfLmlzU3RyaW5nKGxvY2Fscy51c2VyLmxhc3RfbG9jYWxlKSlcbiAgICAgICAgbG9jYWxzLmxvY2FsZSA9IGxvY2Fscy51c2VyLmxhc3RfbG9jYWxlO1xuXG4gICAgICBpZiAoXy5pc1N0cmluZyhsb2NhbHMubG9jYWxlKSkgaTE4bi5zZXRMb2NhbGUobG9jYWxzLmxvY2FsZSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgUHJvbWlzZS5wcm9taXNpZnkocmVuZGVyRm4pKGZpbGVQYXRoLCBsb2NhbHMpO1xuICAgIC8vIHRyYW5zZm9ybSB0aGUgaHRtbCB3aXRoIGp1aWNlIHVzaW5nIHJlbW90ZSBwYXRoc1xuICAgIC8vIGdvb2dsZSBub3cgc3VwcG9ydHMgbWVkaWEgcXVlcmllc1xuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2dtYWlsL2Rlc2lnbi9yZWZlcmVuY2Uvc3VwcG9ydGVkX2Nzc1xuICAgIGlmICghdGhpcy5jb25maWcuanVpY2UpIHJldHVybiByZXM7XG4gICAgY29uc3QgaHRtbCA9IGF3YWl0IHRoaXMuanVpY2VSZXNvdXJjZXMocmVzKTtcbiAgICByZXR1cm4gaHRtbDtcbiAgfVxuXG4gIC8vIFRPRE86IHRoaXMgbmVlZHMgcmVmYWN0b3JlZFxuICAvLyBzbyB0aGF0IHdlIHJlbmRlciB0ZW1wbGF0ZXMgYXN5bmNocm9ub3VzbHlcbiAgYXN5bmMgcmVuZGVyQWxsKHRlbXBsYXRlLCBsb2NhbHMgPSB7fSwgbWVzc2FnZSA9IHt9KSB7XG4gICAgbGV0IHN1YmplY3RUZW1wbGF0ZUV4aXN0cyA9IHRoaXMuY29uZmlnLmN1c3RvbVJlbmRlcjtcbiAgICBsZXQgaHRtbFRlbXBsYXRlRXhpc3RzID0gdGhpcy5jb25maWcuY3VzdG9tUmVuZGVyO1xuICAgIGxldCB0ZXh0VGVtcGxhdGVFeGlzdHMgPSB0aGlzLmNvbmZpZy5jdXN0b21SZW5kZXI7XG5cbiAgICBpZiAodGVtcGxhdGUgJiYgIXRoaXMuY29uZmlnLmN1c3RvbVJlbmRlcilcbiAgICAgIFtcbiAgICAgICAgc3ViamVjdFRlbXBsYXRlRXhpc3RzLFxuICAgICAgICBodG1sVGVtcGxhdGVFeGlzdHMsXG4gICAgICAgIHRleHRUZW1wbGF0ZUV4aXN0c1xuICAgICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZUV4aXN0cyhgJHt0ZW1wbGF0ZX0vc3ViamVjdGApLFxuICAgICAgICB0aGlzLnRlbXBsYXRlRXhpc3RzKGAke3RlbXBsYXRlfS9odG1sYCksXG4gICAgICAgIHRoaXMudGVtcGxhdGVFeGlzdHMoYCR7dGVtcGxhdGV9L3RleHRgKVxuICAgICAgXSk7XG5cbiAgICBpZiAoIW1lc3NhZ2Uuc3ViamVjdCAmJiBzdWJqZWN0VGVtcGxhdGVFeGlzdHMpIHtcbiAgICAgIG1lc3NhZ2Uuc3ViamVjdCA9IGF3YWl0IHRoaXMucmVuZGVyKFxuICAgICAgICBgJHt0ZW1wbGF0ZX0vc3ViamVjdGAsXG4gICAgICAgIE9iamVjdC5hc3NpZ24oe30sIGxvY2FscywgeyBwcmV0dHk6IGZhbHNlIH0pXG4gICAgICApO1xuICAgICAgbWVzc2FnZS5zdWJqZWN0ID0gbWVzc2FnZS5zdWJqZWN0LnRyaW0oKTtcbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS5zdWJqZWN0ICYmIHRoaXMuY29uZmlnLnN1YmplY3RQcmVmaXgpXG4gICAgICBtZXNzYWdlLnN1YmplY3QgPSB0aGlzLmNvbmZpZy5zdWJqZWN0UHJlZml4ICsgbWVzc2FnZS5zdWJqZWN0O1xuXG4gICAgaWYgKCFtZXNzYWdlLmh0bWwgJiYgaHRtbFRlbXBsYXRlRXhpc3RzKVxuICAgICAgbWVzc2FnZS5odG1sID0gYXdhaXQgdGhpcy5yZW5kZXIoYCR7dGVtcGxhdGV9L2h0bWxgLCBsb2NhbHMpO1xuXG4gICAgaWYgKCFtZXNzYWdlLnRleHQgJiYgdGV4dFRlbXBsYXRlRXhpc3RzKVxuICAgICAgbWVzc2FnZS50ZXh0ID0gYXdhaXQgdGhpcy5yZW5kZXIoXG4gICAgICAgIGAke3RlbXBsYXRlfS90ZXh0YCxcbiAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgbG9jYWxzLCB7IHByZXR0eTogZmFsc2UgfSlcbiAgICAgICk7XG5cbiAgICBpZiAodGhpcy5jb25maWcuaHRtbFRvVGV4dCAmJiBtZXNzYWdlLmh0bWwgJiYgIW1lc3NhZ2UudGV4dClcbiAgICAgIC8vIHdlJ2QgdXNlIG5vZGVtYWlsZXItaHRtbC10by10ZXh0IHBsdWdpblxuICAgICAgLy8gYnV0IHdlIHJlYWxseSBkb24ndCBuZWVkIHRvIHN1cHBvcnQgY2lkXG4gICAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2FuZHJpczkvbm9kZW1haWxlci1odG1sLXRvLXRleHQ+XG4gICAgICBtZXNzYWdlLnRleHQgPSBodG1sVG9UZXh0LmZyb21TdHJpbmcoXG4gICAgICAgIG1lc3NhZ2UuaHRtbCxcbiAgICAgICAgdGhpcy5jb25maWcuaHRtbFRvVGV4dFxuICAgICAgKTtcblxuICAgIC8vIGlmIHdlIG9ubHkgd2FudCBhIHRleHQtYmFzZWQgdmVyc2lvbiBvZiB0aGUgZW1haWxcbiAgICBpZiAodGhpcy5jb25maWcudGV4dE9ubHkpIGRlbGV0ZSBtZXNzYWdlLmh0bWw7XG5cbiAgICAvLyBpZiBubyBzdWJqZWN0LCBodG1sLCBvciB0ZXh0IGNvbnRlbnQgZXhpc3RzIHRoZW4gd2Ugc2hvdWxkXG4gICAgLy8gdGhyb3cgYW4gZXJyb3IgdGhhdCBzYXlzIGF0IGxlYXN0IG9uZSBtdXN0IGJlIGZvdW5kXG4gICAgLy8gb3RoZXJ3aXNlIHRoZSBlbWFpbCB3b3VsZCBiZSBibGFuayAoZGVmZWF0cyBwdXJwb3NlIG9mIGVtYWlsLXRlbXBsYXRlcylcbiAgICBpZiAoXG4gICAgICBzLmlzQmxhbmsobWVzc2FnZS5zdWJqZWN0KSAmJlxuICAgICAgcy5pc0JsYW5rKG1lc3NhZ2UudGV4dCkgJiZcbiAgICAgIHMuaXNCbGFuayhtZXNzYWdlLmh0bWwpICYmXG4gICAgICBfLmlzQXJyYXkobWVzc2FnZS5hdHRhY2htZW50cykgJiZcbiAgICAgIF8uaXNFbXB0eShtZXNzYWdlLmF0dGFjaG1lbnRzKVxuICAgIClcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYE5vIGNvbnRlbnQgd2FzIHBhc3NlZCBmb3Igc3ViamVjdCwgaHRtbCwgdGV4dCwgbm9yIGF0dGFjaG1lbnRzIG1lc3NhZ2UgcHJvcHMuIENoZWNrIHRoYXQgdGhlIGZpbGVzIGZvciB0aGUgdGVtcGxhdGUgXCIke3RlbXBsYXRlfVwiIGV4aXN0LmBcbiAgICAgICk7XG5cbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuXG4gIGFzeW5jIHNlbmQob3B0aW9ucyA9IHt9KSB7XG4gICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIHRlbXBsYXRlOiAnJyxcbiAgICAgICAgbWVzc2FnZToge30sXG4gICAgICAgIGxvY2Fsczoge31cbiAgICAgIH0sXG4gICAgICBvcHRpb25zXG4gICAgKTtcblxuICAgIGxldCB7IHRlbXBsYXRlLCBtZXNzYWdlLCBsb2NhbHMgfSA9IG9wdGlvbnM7XG5cbiAgICBjb25zdCBhdHRhY2htZW50cyA9XG4gICAgICBtZXNzYWdlLmF0dGFjaG1lbnRzIHx8IHRoaXMuY29uZmlnLm1lc3NhZ2UuYXR0YWNobWVudHMgfHwgW107XG5cbiAgICBtZXNzYWdlID0gXy5kZWZhdWx0c0RlZXAoXG4gICAgICB7fSxcbiAgICAgIF8ub21pdChtZXNzYWdlLCAnYXR0YWNobWVudHMnKSxcbiAgICAgIF8ub21pdCh0aGlzLmNvbmZpZy5tZXNzYWdlLCAnYXR0YWNobWVudHMnKVxuICAgICk7XG4gICAgbG9jYWxzID0gXy5kZWZhdWx0c0RlZXAoe30sIHRoaXMuY29uZmlnLnZpZXdzLmxvY2FscywgbG9jYWxzKTtcblxuICAgIGlmIChhdHRhY2htZW50cykgbWVzc2FnZS5hdHRhY2htZW50cyA9IGF0dGFjaG1lbnRzO1xuXG4gICAgZGVidWcoJ3RlbXBsYXRlICVzJywgdGVtcGxhdGUpO1xuICAgIGRlYnVnKCdtZXNzYWdlICVPJywgbWVzc2FnZSk7XG4gICAgZGVidWcoJ2xvY2FscyAoa2V5cyBvbmx5KTogJU8nLCBPYmplY3Qua2V5cyhsb2NhbHMpKTtcblxuICAgIC8vIGdldCBhbGwgYXZhaWxhYmxlIHRlbXBsYXRlc1xuICAgIGNvbnN0IG9iaiA9IGF3YWl0IHRoaXMucmVuZGVyQWxsKHRlbXBsYXRlLCBsb2NhbHMsIG1lc3NhZ2UpO1xuXG4gICAgLy8gYXNzaWduIHRoZSBvYmplY3QgdmFyaWFibGVzIG92ZXIgdG8gdGhlIG1lc3NhZ2VcbiAgICBPYmplY3QuYXNzaWduKG1lc3NhZ2UsIG9iaik7XG5cbiAgICBpZiAodGhpcy5jb25maWcucHJldmlldykge1xuICAgICAgZGVidWcoJ3VzaW5nIGBwcmV2aWV3LWVtYWlsYCB0byBwcmV2aWV3IGVtYWlsJyk7XG4gICAgICBhd2FpdCBwcmV2aWV3RW1haWwobWVzc2FnZSk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZy5zZW5kKSB7XG4gICAgICBkZWJ1Zygnc2VuZCBkaXNhYmxlZCBzbyB3ZSBhcmUgZW5zdXJpbmcgSlNPTlRyYW5zcG9ydCcpO1xuICAgICAgLy8gPGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlbWFpbGVyL25vZGVtYWlsZXIvaXNzdWVzLzc5OD5cbiAgICAgIC8vIGlmICh0aGlzLmNvbmZpZy50cmFuc3BvcnQubmFtZSAhPT0gJ0pTT05UcmFuc3BvcnQnKVxuICAgICAgdGhpcy5jb25maWcudHJhbnNwb3J0ID0gbm9kZW1haWxlci5jcmVhdGVUcmFuc3BvcnQoe1xuICAgICAgICBqc29uVHJhbnNwb3J0OiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmNvbmZpZy50cmFuc3BvcnQuc2VuZE1haWwobWVzc2FnZSk7XG4gICAgZGVidWcoJ21lc3NhZ2Ugc2VudCcpO1xuICAgIHJlcy5vcmlnaW5hbE1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIHJldHVybiByZXM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFbWFpbDtcbiJdfQ==